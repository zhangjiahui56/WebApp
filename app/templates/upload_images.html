{% extends "base.html" %}

{% block content %}
<main class="main_full">
    <div class="container" id="upload-container">
      <form method="POST" action="{{url_for('uploaded_file')}}" enctype="multipart/form-data" id="form-upload">
        <div class="upload-panel">
            <div class="button_outer">
                <div class="btn_upload">
                    <input type="file" id="upload_file" name="file">
                    Choose Image
                </div>
                <div class="processing_bar"></div>
                <div class="success_box"></div>
            </div>
        </div>
        <div class="error_msg"></div>
        <div class="uploaded_file_view" id="uploaded_view">
            <span class="file_remove">X</span>
        </div>
      </form>
    </div>
</main>

<script>
  var btnUpload = $("#upload_file"),
        btnOuter = $(".button_outer");
    btnUpload.on("change", function(e){
        var ext = btnUpload.val().split('.').pop().toLowerCase();
        if($.inArray(ext, ['gif','png','jpg','jpeg']) == -1) {
            $(".error_msg").text("Not an Image...");
        } else {
            $(".error_msg").text("");
            btnOuter.addClass("file_uploading");
            setTimeout(function(){
                btnOuter.addClass("file_uploaded");
            },3000);
            var uploadedFile = URL.createObjectURL(e.target.files[0]);
            setTimeout(function(){
                $("#uploaded_view").append('<img src="'+uploadedFile+'" />').addClass("show");

                $("#form-upload").append('<button type="submit" class="btn btn-primary" style="display: block; margin: 0 auto;">Upload</button>');
            },3500);
        }
    });
    $(".file_remove").on("click", function(e){
        $("#uploaded_view").removeClass("show");
        $("#uploaded_view").find("img").remove();
        $("#form-upload").find("button").remove();
        btnOuter.removeClass("file_uploading");
        btnOuter.removeClass("file_uploaded");
    });
</script>
{% endblock %}