{% extends "admin/layout.html" %}

{% block content %}
<!-- Page Wrapper -->
<div id="wrapper">

{% include "admin/_slidebar.html"%}

<!-- Content Wrapper -->
<div id="content-wrapper" class="d-flex flex-column">

  <!-- Main Content -->
  <div id="content">

    {% include "admin/_topbar.html"%}

    <!-- Begin Page Content -->
    <div class="container-fluid">
      {% include 'admin/_messages.html' %}

      <!-- DataTales Example -->
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">DataTables User </h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Username</th>
                  <th>Name</th>
                  <th>Role</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user in users %}
                    <tr>
                      <td>{{user.id}}</td>
                      <td>{{user.username}}</td>
                      <td>{{user.name}}</td>
                        {% if user.is_admin %}
                            <td>Admin</td>
                        {% else %}
                            <td>User</td>
                        {% endif %}
                      <td>
                        {% if user.is_admin == 0 %}
                         <a class="add" title="Add" data-toggle="tooltip" href="#"><i class="material-icons">&#xE03B;</i></a>
                         <a class="edit" title="Edit" data-toggle="modal" data-target="#editUser" data-user-id={{user.id}} data-username={{user.username}} href="#"><i class="material-icons">&#xE254;</i></a>
                         <a class="delete" title="Delete" data-toggle="modal" data-target="#deleteUserModal" data-user-id={{user.id}} href="#" ><i class="material-icons">&#xE872;</i></a>
                        {% endif %}
                      </td>
<!--                      data-toggle="modal" data-target="#logoutModal"-->

                    </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
    <!-- /.container-fluid -->

  </div>
  <!-- End of Main Content -->

  <!-- Footer -->
  <footer class="sticky-footer bg-white">
    <div class="container my-auto">
      <div class="copyright text-center my-auto">
        <span>Copyright &copy; Your Website 2019</span>
      </div>
    </div>
  </footer>
  <!-- End of Footer -->

</div>
<!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
<i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
      <button class="close" type="button" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">×</span>
      </button>
    </div>
    <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
    <div class="modal-footer">
      <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
      <a class="btn btn-primary" href="{{ url_for('logout') }}">Logout</a>
    </div>
  </div>
</div>
</div>

<!--delete user modal-->
  <div class="modal fade" id="editUser" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Edit User</h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form action="{{url_for('admin.edit_user')}}" method="post" id="edit-form">
        {{form.hidden_tag()}}
      <div class="modal-body">

        <input type="hidden" name="user_id" id="user_id" value="">
        <div class="form-group" id="user_id">
          ID:
        </div>
        <input type="hidden" name="username" id="username" value="">
        <div class="form-group" id="username">
          Username:
        </div>
        <div class="form-group" id="">
			<div class="input-group">
            {{form.name(class_="form-control", placeholder="Name")}}
            </div>
        </div>
        <div class="form-group">
			<div class="input-group">
              {{form.password(class_="form-control", placeholder="Password")}}
            </div>
        </div>
        <div class="form-group">
			<div class="input-group">
            {{form.confirm(class_="form-control", placeholder="Confirm Password")}}
            </div>
        </div>
        <div class="form-group">

            {% for subfield in form.is_admin %}
                <tr>
                    <td>{{ subfield }}</td>
                    <td>{{ subfield.label }}</td>
                </tr>
            {% endfor %}
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
<!--        <a class="btn btn-primary" id="edit-form-submit" name="save" href="" >Save </a>-->
<!--        <button class="btn btn-primary" type="submit" data-dismiss="modal" href="">Save</button>-->
        <input class="btn btn-primary" type="submit" value="Save" />
      </div>
      </form>
    </div>
    </div>
  </div>

<!--delete user modal-->
  <div class="modal fade" id="deleteUserModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Confirm</h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">Select "Confirm" below if you want to delete user.
        <input type="hidden" name="user_id" id="user_id" value="">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
        <a class="btn btn-primary" name="confirm" href="" >Confirm </a>
      </div>
    </div>
    </div>
  </div>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
        $(function(){
            $('#example').popover({ trigger:'hover' });
        });
  });
  $('#deleteUserModal').on('show.bs.modal', function(e) {

    //get data-id attribute of the clicked element
    var user_id = $(e.relatedTarget).data('user-id');
    //populate the textbox
    var admin_link = "http://127.0.0.1:5000/admin/"
    $(e.currentTarget).find('a[name="confirm"]').attr("href", admin_link + "user/" + user_id + "/delete");
  });
  $('#editUser').on('show.bs.modal', function(e) {

    //get data-id attribute of the clicked element
    var user_id = $(e.relatedTarget).data('user-id');
    var username = $(e.relatedTarget).data('username')
    //populate the textbox

    var admin_link = "http://127.0.0.1:5000/admin/"
    $(e.currentTarget).find('input[id="user_id"]').val(user_id)
    $(e.currentTarget).find('input[id="username"]').val(username)
    $(e.currentTarget).find('div[id="user_id"]').text("ID: "+user_id)
    $(e.currentTarget).find('div[id="username"]').text("Username: "+username)
    //$(e.currentTarget).find('a[name="save"]').attr("href", admin_link + "user/" + user_id + "/edit");
  });

</script>
{% endblock %}